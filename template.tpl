___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Jobster.com - Conversion Tracker",
  "categories": ["CONVERSIONS"],
  "brand": {
    "id": "code-cube",
    "displayName": "Jobster.com",
    "thumbnail": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAAAXNSR0IArs4c6QAAF1BJREFUeNrt3T1vG2e6gGH+BAGWSGJNEgTipHFjKG7iSoqKuJQbl7EKt3YEt7IR1QkQq4wXAZTOhlM4jT9SscpuKSCya8HOD5D1C7TzSpaWoUmJlvgxM8/1ABfOnnM22DU11tzzzjvDSsWMZer1dvvixfaVer25Mltrrc7Vmg/nqq3N7H925mqNrWqtuZNk//tuZh8gmN2u34OdA4e/Ix+m35nVanM5+z260G63Z5xRTG5P9OlAPTjJHxy8jS0ndYDRxsKHC6dn1XprXRiYaZ3wFw7qNB2Ih+XqLyfAdKQVhGfpd3L63ewMZUY6aRn/wxJ+x5U9QN5XCpqd9Ds7/e52BjNnuspP96Fc4QMUe4VgrtrctDpghjrpu8oHEAOm5JM2kVSrre+d9AGCxUB2wZc2cTsTxrza7/hLABBeZy57XNuZ0dU+AFFXBbIQsCrgxA9A7L0CQsCJH4CQhIATPwBCwBnWiR+AiG8dzM4xzrY5m/Qu/jkv7QFgQpsFnXmn/zhf2+N8AExa+g4CtwWmdtVvuR+AKYeA2wITf4mP5X4AcnNbwGrAmGeu1nroQAPAakCoe/2NLQcYAFYD4lz1f+dePwAFslurtVadwc/xXL8lfwAK7GE6lzmjW/IHwC0Bc8ouf0v+AJQmAmazc5sz/On3+x0sAHhKIM6LfRrfO0AAEAGBNvtl7/LfdGAAEEJ2znPyP9jpb7MfANE0tsI+IWCnPwDRIyDcEwIfvsVvxw8fAI8JBokAJ38ACBYBTv4AECwCbPgDgIAbA538ASBYBHjOHwCCvSfAG/4A4NMU/o2BTv4AcDa1Wmu1yN/q54cIAGdUuG8R9LgfAIzEbmEeDzx83M/JHwBCPRkwV2s99MMCgJF6mPeT/3d+SAAQaFPgh/v+u35IABBoP4D7/gAw/v0AnvcHAPsBpr707wcCAJHeD2DpHwAmbsfSPwAEVK231i39A4CnAiYzs7XmMx8+AExVZ7L3/evNFR86AOTgVkC1uWzjHwAE3BA4ke8KsPEPAIJtCPQ1vwCQzw2BY10FmKs2N33IABBoFcBjfwAQcBXA1T8ABFsFcPUPAAFXAVz9A0CwVQA7/wEg4CqAt/4BQMBVAFf/AFC8VQBX/wAQ0Gy9vXCeq/+ODxEACqnj0T8ACOhMmwHnaq0NHx4ABNsMaPMfAATbDFivNxZ8aAAQbDOgN/8BQFk0Niz/A4DbAJb/AcBtAMv/ABD3NoDlfwAonZ2TT/5z7Ss+JAAon4sX21cGBsBsrbXqQwKA8qll53jv/geAeDonvf531wcEAIEeB/T4HwAEfBzQ/X8ACLgPYLbWfObDAYDyqtaav3v+HwCivw9gZqY940MBgPKr19ttGwABINptgH81l48DoFpvrftQACDYRkAbAAEgiHprs/sFQFs+FACI8CRAa8sbAAEgnl1PAABA1CcBPAEAALEcfDXwhWpz2YcBAJE2AjZXfAcAAER8FDDbALjhwwCASBob6SVAv/ogACDYuwCyf9HxYUBMd+7e2//zz//u7+3t7Ztiz/b2m/3HT57uf3n1mmObYfYAdAQABHTp88sHJ35Tvnn37u/9xaXrjnNOdPAyoKqvAYZw0pWiKe+8z1Z0rARwih0BAMEs37jpDBlgfn70i+OdkwPAa4AhlkfZicHEWAVwvHOC3YoPAWJx7z/OzLsNwAkEAAgAIwAQAIAAMAIAAQAIACMAEACAADACAAEACAAjABAAgAAwAgABAAgAIwAQAIAAMAIAAQAIACMAEACAADACAAEACAAjABAAgAAwAgABAAgAIwAQAIAAMAIAAQAIACMAEACAABAAIABAAAgAAQACAASAEQAIAEAAGAGAAAAEgBEACABAABgBgAAABIARAAgAQAAYAYAAAASAEQAIAEAAGAGAAAAEgBEACABAABgBgAAABIARAAgAQAAYAYAAAASAEQAIAEAAGAGAAAAEgBEACABAAAgAEACAABAAIABAABgBgAAABIARAAgAQAAYAYAAAASAEQAIAEAAGAGAAAAEgBEACABAABgBgAAABIARAAgAQAAYAYAAAASAEQAIAEAAGAGAAAAEgBEACABAABgBgAAABIARAAgAQAAYAYAAAASAAHDMIwAAASAAQACAADACAAEACAAjABAAgAAwAgABAAgAIwAQAIAAMAIAAQAIACMAEACAADACAAEACAAjABAAgAAwAgABAAgAIwAQAIAAMAIAAQAIACMAEACAADACAAEACAAjABAAgAAwAgABAAgAASAAEACAABAAIABAABgBgADwIYAAMAIAAQAIACMAEACAADACAAEACAAjABAAgAAwAgABAAgAIwAQAIAAMAIAAQAIACMAEACAADACAAEACAAjABAAgAAwAgABAAgAIwAQAIAAMAIAAQAIACMAEACAADACAAEACAABAAIABIARACAAQAAYAYAAAASAEQAIAEAAGAGAAAAEgBEACABAABgBgAAABIARAAgAQAAYAYAAAASAEQAIAEAAGAGAAAAEgBEACABAABgBgAAABIARAAgAQAAYAYAAAASAEQAIAEAAGAGAAAAEgAAAAQACQAAIABAAIACMAEAAAALACAAEACAAjABAAAACwAgABAAgAIwAQAAAAsAIAAQAIACMAEAAAALACAAEACAAjABAAAACwAgABAAgAIwAQAAAAsCcaRzvCABAAAgAEAAgAIwAQAD4EEAAmNLNu3d/O94RAIAAiDbbr9843hEAgACINunn7HhHAAACINg8fvKb4x0BAAiAaPPDjz853hEAgACINmsP1h3vCABAAESb5Rs3He8IAEAARJvFpW8c7wgAQABEG8c6AgAQAN4BAAIABIAAKPs8f/nKsY4AAASARwBBAIAAEACln1srtx3rCABAAESb+avXHOsIAEAARJq3vgUQAQAIABsAQQAAAiDAeAUwAgAQAAHHGwARAIAACDbv9/Yc4wgAQAC4/w8CABAApZ87d+85xhEAgADw/D8IAEAAlHrSz9XxjQAABIDH/0AAAALA8j8IABAAplSz/fqNYxsBAAgAu/9BAAACwPI/CABAAJRrvPwHAQAIgIBza+W24xoBAAiASPP23d+OaQQAIABs/gMBAAgAm/9AAAACoFzz+MlTxzMCABAArv5BAAACwNU/CABAALj6BwEAAsAZ1NU/CAAQAMbVPwIAEADG1T8CABAAxtU/AgAQAGZK88OPPzl+EQCAAIg06Z3/n31+2fGLAAAEQKTxzn8EACAAgs2Ll384bhEAgACw8Q8EACAAbPwDAQAIgHJt/HO8IgAAARBo3u/tWfpHAAACINqsPVh3rCIAAAEQabzuFwEACICA9/0t/SMAAAHgkT8QAIAAcN8fBAAgAEozPz/6xbGJAAAEQKT5a/u14xIBAAgAm/5AAAACwMkfBAAgAMrzpr/FpeuORwQAIAAizfKNm45FBAAgACLNnbv3HIcIAEAAOPmDAAAEgJM/CABAADj5gwAABIDd/iAAAAGQ9+f8nfwRAIAA8JIfEACAACjrpM/3s88vO9YQAIAAiDK+1Q8BAAiAYJv91h6sO74QAIAAcL8fBAAgAEq75O9+PwIAEACBlvy/vXXb8YQAAARApF3+lvwRAIAAsNEPBAAgAMo4j588da8fAQAIgCjz1/br/eUbNx03CABAAFjuBwEACIDSnfh/+PEny/0IAKB83mUvrjFO/CAAIBjjxA8CAIK59MVlZ30nfhAAEE3a0R79JT529YMAgHDSVa+rfUAAgCcASnvST1/U42ofBAC4/1/y+/9O+iAAgD5urdwu3Qk/rWjcz17Ys7h03c8YBADQT3qffdFne/vN8VW+e/ogAIBTfHn1q8Je5T9+8tv+nbv3nPBBAACfau3+euGW9d3LBwEAnFOeX/+b/rtZ1gcBAIxYupq2rA8IAAh273/aV/+W9UEAAEF2/lvWBwEATMm3t25PfFk/XeXPX73m8wcBAJR16T8t66d37FvWBwEA5MQ43vl/dC/f5j0QAEAOjfob/3ybHggAINDJ34kfBAAQ7OSfdvA78YMAAHLuUXbCHsW8zTYO2tQHAgDIuUvZVfqoNvyldwa46gcBAORculIf1aN+6faBzxQEAJDzq/5RLfmnWcte3uNzBQEA5Fh6Bn8v253v5A8IAAhwxZ9esTvqN/tZ9gcB4IOAnN7jT4/jjfKK38kfEACQwyv9cZ70ux/183kDAgBysLyfHuUb50m/++1+vq0PEAAwpaX9tAQ/ji/ssekPEAAQbGnf0j8gACDY0v4ws7h03c8GEABQpqX9YV7z62cECAAo0dL+MOMLfgABACVb2j9ttl+/8bMDBACUaWl/mEmvD/ZzBAQAlGhpf5jx3D8gAKBES/vDTPrz+PkCAgBKtLTvxT+AAIBPOOmXZWl/uGf/v/FzBwQAcZf305X+qL9ON++T3vvv5w8IAEJe7Zd5ed/9f0AAQM9mvmhX+/3m+ctXjglAABBjmT/Kvf1hJn0ejg1AAODEH2w8AQAIAEopLfU78XsDICAACLS5zz1+AQAIAIL48upX+y+yjW1GAAACAMv9ZsDcWrnt2AEEAMW96o/8LP95Jt0qcQwBAgBX/QIAQACQ70f7Hj956gwuAAABQBRfL123w18AAAKASNKudUv+AgAQAASS3uZnBAAgAHC/35xzFpe+cYwBAoB8PuK3vf3amXpMM3/1muMMEADk7+Rvs58AAAQATv5GAAACACd/IwAAAYCTvxEAgADAyd8IAEAA4ORv+oxjDxAATPU5f4/6CQBAABDMi5evnIkFACAAiMTrfQUAIAAI5v6DdWdgAQAIAKJt+jMCABAA2PFvJjzvs69VdjwCAoCJ8c1++ZgUYY5HQADgvr8AABAAjGfpfy9bdjYCABAABOJlPwIAEABY+jcCABAAWPo3AgAQANj1b8Y+f/75X8cnIAAYjzt37znTCgBAABCNF/4IAEAA4OrfCABAAFD2jX+u/gUAIAAIxtf8CgBAAODq3wgAQADg6t/kYR4/+c3xCggAXP0LAAABgJ3/AgAQAD4EPPcvAAABAK7+BQAgAOBQ2lVuBAAgAAi2+c8Ua35+9ItjFxAAnI9v/CvepMc1HbuAAMDmPwFQWvNXrx3sUUl/5nTrI0n/+v6D9f3lGzf9HQYBwFmkX6BGAOTNpc8vH/wZt7ffDLkn4qkYAAGA5X8BUPS3Ue7t7Z3pc0mbWb/MVgz83QYBgOV/AVCgzajb269P/HO/z8Lg/RBxYI8ECAAs/wuAAvh66XrfGE0n+/TEQzpWP8tuC3T/M4vZP5P2Bgx6hPXRvz0pgQDwQdDXo+wXqynmpBNfma78e5f804k/RU7vSX/wRsGv+t7OSv83f9cRANBj2A1WRgCM8+Tfe+X/V3YbYP6M9/H7fZvlWva0gL/vCADw8h8BkONNqOnkP+xV/yD9XmttYyACAE74JWkEwDQj9G22EjA/ohP12v31nqcD/uPvPQIAPP4nAPJ4DH5763ZPIFw72Px3kksnrBakk373eE8AAgA8/icAcnb1//zlqzNH6qBn/3ufcvH9CQgAwrv0xWVn0ILPrZXbpboF1e/q/FNWqQYt8XevAqQnC/z9RwAQWjp5mGJP0Zezn7/449QTc3cAHL33v1vvjv9+twPSP9c9i0vf+B2AACCufo9KGQEwrUdQ0xL+aQEw6M/bfSur3wbCxa+vl/b9CSAAONfVlxEA0zDMvfnuAEgn7nSC79Z9jz89QTDM7S6vCEYA4AVARgDkJAAGnZSH3QOQbiGk1wKf5z8LBAAhGAFQtBWAk2bvw2uDBQAIAE7Qe0/UCIBpP4b6+MlvpwZAOnGn2wDd0ga/o28GHLSR0B4ABAAMeDbaFHOKvpu9ex/KuwH370exCbD3iRcvA0IAEFbvY1GmmDNf8Hfb9z6J0u8e/igCoPc2wqVzfs8ACAA8AmgEwAhXovrdm0//nqPl/kF/3nSFf/Tv6T25975tcNDjhiAACMF3AAiAPD6Nku7hj/ob+3qPdff/EQCElq6CjADIg97XAY/yG/u+Xvrn5r9B7wkAAYAAMAJgKqsAr0f+mF5a+u/9sitX/wgAwvMtgAIgV4+lLn38WOp5IqDfyT/dCvB3HwGAABAApZgyHZNr9z9+MiXdDvjUPQHpCZe9D+8F6F76L0ssgQDAWwBNmKdT0tX7Sc/up53/6cTf79aWkz8CwIeAABAABV0JOJp0ZZ9O8umtgUdO+k6Lv7K9BU7+CAAfAgJAABTEfHYP/+05blO9P+V7AUAAIABMYWfQe+/LJO3a/5RvrUyfSfpSIVf98I8AaO36ILAJsDzz/OWrMMdrWhFI9/hfvPzjIAjS8Xsk3RJIJ/30NsDPvOIXeu1WqrXmjg+C0zZbmeKML7QBhrAjAPjnrukvLp/rHquZ7ri/DQwdANktgC0fBL3Lqt1fx2qKcd9/LVsKd/wCQ6k3O2kTYMeHwaC3sKX7q+mqknxKPx/3uIEzBUC13vrVhwEAkQKgtZluAWz4MAAgksZGZbbWWvVBAEActezcX8nuA6z4MAAgjuq/msuVubn2FR8GAMQxW28vVOr1dtuHAQBxtNvtmUoarwMGgDB2K0fjZUAAEOT+f3bOPw4A7wIAgCgB0Pz9OAA8CggAQQKg3lo/DoAL1eayDwUAgjwBcDSeBACAYE8AHO8D8LXAAFD2DYA7ld6ZrTWf+XAAIMgGQBsBASCGg+8A+CgA6o0FHw4ABNkA2D3eCAgApbVbGTTZ/7PjAwKAEqo3OwMDwD4AAAh0//94BcBXAwNAKV282L5SOWm8DwAAAjz/32cj4IYPCwBKdf9/89QA8DggAAR5/M/jgAAQePnfbQAACLj87zYAAARd/ncbAAACLv8fPw5Yb6z78ACgyBobnxwAMzPtGR8cABRXvd5uV84yc74bAACKuvmvUznr2AwIAIUNgJXKecZmQAAIsPnPZkAACH71///NgFYBAKAoV/9n3vxnFQAACnv1v1kZ1VgFAICSP/pnFQAAXP1bBQCAqFf/VgEAIODVv1UAAAiy898qAAAUw2y9tV4Z96RVgFQaPnAAyMfVf2VSc6HaXPahA0Au7v2vVCY5c74pEACmfPXffFaZ9KTNBjYEAkAJH/uzIRAAAm/8OzECbAgEgPJu/Bs0s/XGgh8GAARY+v/oqYBaY8MPBAACLP1//FRAa8sPBgBKvvTvqQAAmKTWbm6W/j/aD1BrrfoBAcAYlv5rF1creR77AQBg1BoblbzPh28MtB8AAEZ037/dbs9UijD2AwDAaE7+ub3v7/0AADCuR/4aC5Uijk2BAFCS5/3PsBLg+wIAINLJ//glQdXmr36gADCEevPXSlnGkwEAMIzWVqVsIwIA4OSTf2Ee9zvL44G+PhgASvC4nwgAACd/EQAATv6nvi3QngAAwt7zD3fytzEQABv+Srrhz3sCAKD/c/5O/t4YCEAgpXnDnwgAgCFP/rWLq870p3yLoCcEACjR/f7dwn6rn8cEAcBO/4k9IXCh1thw8ABQTI0Nm/3Oc0ug1lpNyycOJAAKs+Tvfr9bAgBY8jeeEgCgxEv+ztRWAwAIIp2T7PK3GgBArMf7vNhnWqsBs7XmMwchABNVb3bc68/DdwnUmytuCwAwieX+arW57Mybw9sCQgCAcS33e64/57cF0jctOVgBcOIXAgDgxB8xBNwaAMCJP24I2CwIgBN/5KcG0iMcDngAj/N5iU/UVYHs1Y1WBQBc7Zu4jxAu2CsAUN6Tfrrgc7VvxABA2V/aU2/uOOmbs+8XmGtfma21Vg/3DKSC9JcKILdX+emefvqdnf3udgYzI18dSAdX+g4CKwQA073CT7+LD34nu8o3k560iSQdeNV6a/3wi4laW1YKAEZ9/z773VpvbaaT/YXsXfwzvojH5D0M0oF6sByV3YdKB+/BrYRMKtfD+1NiAYh5Uu/6Pbh1+Lsx+x2Z7tkf3nZdScv4TvTjm/8Bop7wrp43fjYAAAAASUVORK5CYII\u003d"
  },
  "description": "Jobster.com conversion tracker",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "SELECT",
    "name": "action",
    "displayName": "action",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "init",
        "displayValue": "Initialize (on all pages)"
      },
      {
        "value": "conversion",
        "displayValue": "Track Application (on the thank you/confirmation)"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "init"
  },
  {
    "type": "TEXT",
    "name": "conversionId",
    "displayName": "Conversion ID (from Jobster)",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "action",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "conversionLabel",
    "displayName": "Tracker Type",
    "macrosInSelect": true,
    "selectItems": [
      {
        "value": "customer",
        "displayValue": "Customer Level"
      },
      {
        "value": "company",
        "displayValue": "Company Level"
      }
    ],
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "action",
        "paramValue": "conversion",
        "type": "EQUALS"
      }
    ],
    "defaultValue": "customer"
  },
  {
    "type": "CHECKBOX",
    "name": "debug",
    "checkboxText": "Debug mode",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require GTM APIs
const injectScript   = require('injectScript');
const callInWindow   = require('callInWindow');
const copyFromWindow = require('copyFromWindow');
const logToConsole   = require('logToConsole');
const setInWindow    = require('setInWindow');

const action          = data.action;
const conversionId    = data.conversionId;
const conversionLabel = data.conversionLabel;
const sdkUrl          = 'https://cdn.platform.jobster.com/sdk.js';
const debug_enabled   = data.debug;

const debugLog = function(message, debug_enabled){
  if (debug_enabled) {
    logToConsole(message);
  }
};

// Expose a page-context bridge so we can call window.* from the template
setInWindow('jobsterCall', function () {
  var method = arguments[0];
  
  if (method === 'init') {
    // no args
    callInWindow('jobster.init');
  } else if (method === 'conversion') {
    // two args: id, type
    var id = arguments[1];
    var type = arguments[2];
    callInWindow('jobster.conversion', id, type);
  }
  // else: no-op (we don't support other methods)
}, true);


// --- Validation ---
if (action === 'conversion' && (!conversionId || !conversionLabel)) {
  data.gtmOnFailure();
  return;
}

// --- Handler: after SDK loads ---
const onSdkLoad = function() {
  debugLog('Jobster SDK loaded successfully', debug_enabled);
  if (action === 'init') {
    debugLog('Calling jobster.init()', debug_enabled);
    callInWindow('jobsterCall', 'init');
    data.gtmOnSuccess();
  } else if (action === 'conversion') {
    debugLog('Calling jobster.conversion()', debug_enabled);
    callInWindow('jobsterCall', 'conversion', conversionId, conversionLabel);
    data.gtmOnSuccess();
  }
};

// --- Handler: when SDK fails to load ---
const onSdkFailure = function() {
  logToConsole('Jobster SDK failed to load');
  data.gtmOnFailure();
};

// --- Check if SDK already exists ---
const jobsterObject = copyFromWindow('jobster');
const sdkAlreadyLoaded = !!jobsterObject;

// --- Run immediately if already loaded ---
if (sdkAlreadyLoaded) {
  if (action === 'init') {
    callInWindow('jobsterCall', ['init']);
  } else if (action === 'conversion') {
    callInWindow('jobsterCall', ['conversion', conversionId, conversionLabel]);
  }
  // Always signal success
  data.gtmOnSuccess();
  return;
}

// --- Otherwise: inject SDK and execute after load ---
const main = function() {
  injectScript(sdkUrl, onSdkLoad, onSdkFailure, 'jobster_sdk');
  data.gtmOnSuccess(); 
};

main();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "jobsterCall"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "jobster.init"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "jobster.conversion"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "jobster"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "access_globals"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.platform.jobster.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Testing Initialize
  code: |-
    // Require the necessary GTM APIs
    const injectScript = require('injectScript');
    const logToConsole = require('logToConsole');
    const callInWindow = require('callInWindow');

    // Get the configuration data from the template's UI fields
    const action = data.action;
    const conversionId = data.conversionId;
    const conversionLabel = data.conversionLabel;

    // If this is a conversion tag, validate the data BEFORE doing anything else.
    if (action === 'conversion') {
      if (!conversionId || !conversionLabel) {
        logToConsole('Jobster Error: Conversion ID or Label is missing. Aborting.');
        // Fail immediately without loading the script.
        data.gtmOnFailure();
        return;
      }
    }

    // The URL for the Jobster SDK
    const sdkUrl = 'https://cdn.platform.jobster.com/sdk.js';

    // This function will run after the SDK has started loading
    const onSdkLoad = () => {
      // Ensure the global jobster command queue array exists
      callInWindow('eval', 'if (!window.jobster) { window.jobster = []; }');

      if (action === 'init') {
        callInWindow('jobster.push', () => {
          callInWindow('jobster.init');
        });
        logToConsole('Jobster: "init" command pushed.');

      } else if (action === 'conversion') {
        // We already know the data is valid here.
        callInWindow('jobster.push', () => {
          callInWindow('jobster.conversion', conversionId, conversionLabel);
        });
        logToConsole('Jobster: "conversion" command pushed for ID ' + conversionId);
      }

      // Signal to GTM that the tag has successfully completed its task
      data.gtmOnSuccess();
    };

    const onSdkFailure = () => {
      logToConsole('Jobster Error: SDK failed to load from ' + sdkUrl);
      data.gtmOnFailure();
    };

    // Now, we only call injectScript if the initial validation passed.
    injectScript(sdkUrl, onSdkLoad, onSdkFailure, 'jobster_sdk');
- name: Test conversion
  code: |-
    const assertApi = require('assertApi');

    const mockData = {
      action: 'conversion',
      conversionId: 'c9cc49cc-0378-4646-a2b6-8c2b6d0d0a69',
      conversionLabel: 'customer'
    };

    // The assertions are placed inside the callback.
    runCode(mockData, () => {
      assertApi('gtmOnSuccess').wasCalled();
      assertApi('injectScript').wasCalledWith('https://cdn.platform.jobster.com/sdk.js');
    });
- name: Test Failed conversion
  code: |-
    const assertApi = require('assertApi');

    const mockData = {
      action: 'conversion',
      conversionId: 'c9cc49cc-0378-4646-a2b6-8c2b6d0d0a69',
      conversionLabel: undefined
    };

    // The callback is run when the tag fails.
    runCode(mockData, () => {
      assertApi('gtmOnFailure').wasCalled();
      assertApi('injectScript').wasNotCalled();
    });


___NOTES___

Created on 9/9/2022, 9:32:50 AM


